\chapter{拡張後の\tool の外観と機能}\label{cha:Function}
本章では、本研究で新たに提案する、画面遷移を表現するためのダイアグラムである Condition Transition Map (CTM)、および、拡張後の\tool の外観と機能について説明する。

\section{Condition Transition Map (CTM)}\label{sec:CTM}
本研究で新たに提案する Condition Transition Map (CTM)は、画面遷移システムにおけるボタンとイベントの関係を視覚的に表す。
図\ref{fig:specRuleB}の画面仕様に対応するCTMの例を、図\ref{fig:ctm_example}に示す。
拡張後の\tool では、ユーザがGUI操作で編集したCTMから、
Markdown仕様を自動生成し、さらに、\VDM 仕様を自動生成する。
すなわち、GUI操作による\VDM 仕様の編集を可能とする。
\begin{figure}[tp]
  \centering
  \includegraphics[width=0.9\linewidth]{./images/CTM_Example.png}
  \caption{図\ref{fig:specRuleB}の画面仕様に対応するCTMの例}
  \label{fig:ctm_example}
\end{figure}

CTMの6つの構成要素を、以下に示す。また、各要素の表示例を、表\ref{tab:ctm_elements}に示す。以降、この6つの構成要素をCTM要素と呼ぶ。
\begin{itemize}
  \item 画面要素
  \begin{itemize}
    \item 画面要素は、システムの画面を表す要素であり、ラベンダー色の角丸矩形で表現する。
    \item 画面名を保持する。
  \end{itemize}
  \item ボタン要素
  \begin{itemize}
    \item ボタン要素は、ある画面遷移システムにおいて、ユーザが操作可能なボタンを表す要素であり、水色の楕円で表現する。
    \item ボタン名を保持する。
  \end{itemize}
  \item イベント要素
  \begin{itemize}
    \item イベント要素は、ある画面遷移システムにおいて、対象の有効ボタンの押下時に発生する動作を表す要素であり、緑色の矩形で表現する。
    \item 対象の有効ボタンを表すボタン要素から矢印で接続した状態で描画する。
    \item イベント動作名を保持する。
  \end{itemize}
  \item 分岐イベント要素
  \begin{itemize}
    \item 分岐イベント要素は、ある画面遷移システムにおいて、対象の有効ボタン押下時に条件付きで発生する動作を表す要素であり、その条件を分岐条件として、青色の菱形で描画する。
    また、条件付きで発生する動作を、分岐先イベントとして、緑色の矩形で表現する。
    \item 対象の有効ボタンを表すボタン要素から矢印で接続した状態で描画する。
    \item 分岐条件名、および、分岐先イベント動作名を保持する。
  \end{itemize}
  \item タイムアウト要素
  \begin{itemize}
    \item タイムアウト要素は、ある画面遷移システムにおいて、一定時間内に特定の操作が行われなかった場合に発生する動作を表す要素であり、
    CTM上ではタイムアウト時間をピンク色の楕円、タイムアウト後遷移先をピンク色の矩形で表現する。
    \item タイムアウト時間、および、タイムアウト後遷移先名を保持する。
    \end{itemize}
  \item 遷移先のないイベント要素
  \begin{itemize}
    \item 画面遷移を伴うイベントで遷移先のないイベント要素は、イベント動作に対応する画面要素が画面仕様に存在しない場合に表示する要素であり、赤色の矩形で強調して表現する。
    \item イベント動作名を保持する。
    \end{itemize}
\end{itemize}

CTMでは、
ボタン、分岐条件、および、イベントを左から右へ配置することで、
ユーザ操作からシステムの反応までの流れを一方向に表現する。


\begin{table}[tp]
  \caption{CTMを構成する要素表示例}
  \centering
  \label{tab:ctm_elements}
\begin{tabular}{|>{\centering\arraybackslash}m{5cm}|>{\centering\arraybackslash}m{6cm}|}
\hline
\textbf{要素名} & \textbf{図} \\
\hline
\ctmlabel{画面要素}
 & \ctmfig{0.7}{./images/画面.png} \\
\hline
\ctmlabel{ボタン要素} & \ctmfig{0.6}{./images/ボタン.png} \\
\hline
\ctmlabel{イベント要素} & \ctmfig{0.6}{./images/イベント.png} \\
\hline
\ctmlabel{分岐イベント要素} & \ctmfig{1.0}{./images/条件分岐イベント.png} \\
\hline
\ctmlabel{タイムアウト要素} & \ctmfig{1.0}{./images/タイムアウト.png} \\
\hline
\ctmlabel{遷移先のないイベント要素} & \ctmfig{0.6}{./images/遷移エラー.png} \\
\hline
\end{tabular}

\end{table}


\section{スタートページ}\label{sec:start-page}

「スタートページ」は、本研究の拡張で新たに追加する画面である。
「スタートページ」の外観を、図\ref{fig:start_page}に示す。

\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/StartPage.png}
  \caption{スタートページ}
  \label{fig:start_page}
\end{figure}

「スタートページ」は、\tool の起動時に最初に表示する画面である。
「スタートページ」は「Markdown」ボタンと「NoCode」ボタンの2つのボタンを表示し、
ユーザの選択に応じて以下に示すページへ遷移する機能を持つ。

\begin{itemize}
  \item Markdown：「Markdown仕様記述ページ」(\ref{sec:MarkdownPage}節を参照)へ遷移する
  \item NoCode：「GUI操作による\VDM 仕様編集ページ」(\ref{sec:NoCodePage}節を参照)へ遷移する
\end{itemize}

「Markdown」ボタンを押した場合は、図\ref{fig:return_button}に示す、既存の\tool のツール画面である「Markdown仕様記述ページ」に遷移する。また、
「NoCode」ボタンを押した場合は、図\ref{fig:initial_display}に示す、本研究の拡張で新たに追加する「GUI操作による\VDM 仕様編集ページ」に遷移する。


\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/MainPage.png}
  \caption{Markdown仕様記述ページへ遷移直後の画面}
  \label{fig:return_button}
\end{figure}
\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/NoCodePage.png}
  \caption{GUI操作による\VDM 仕様編集ページへ遷移直後の画面}
  \label{fig:initial_display}
\end{figure}

\section{Markdown仕様記述ページ}\label{sec:MarkdownPage}

「Markdown仕様記述ページ」は既存の\tool が保持している画面である(既存部分の詳細は\ref{sec:2vdm-spec-generator}節を参照)。
本研究の拡張では、既存の「Markdown仕様記述ページ」に「スタートページに戻る」ボタンを追加する(図\ref{fig:return_button}を参照)。

ユーザは、「スタートページに戻る」ボタンを押すことで、「Markdown仕様記述ページ」から「スタートページ」へ遷移できる。

\section{GUI操作による\VDM 仕様編集ページ}\label{sec:NoCodePage}

「GUI操作による\VDM 仕様編集ページ」は、本研究の拡張で新たに追加するページである。
図\ref{fig:initial_display}に示した「GUI操作による\VDM 仕様編集ページ」の外観に、説明のために領域ごとに枠を付与したものを、図\ref{fig:NoCodePageScreen}に示す。
「GUI操作による\VDM 仕様編集ページ」は、以下の5つの領域で構成する。

\begin{itemize}
  \item メニューバー
  \item 操作ボタン領域
  \item フォルダツリー表示領域
  \item CTM領域
  \item \VDM 仕様表示領域
\end{itemize}

\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/NoCodePagescreen.png}
  \caption{GUI操作による\VDM 仕様編集ページの外観に領域ごとの
  枠を加えたもの}
  \label{fig:NoCodePageScreen}
\end{figure}

「GUI操作による\VDM 仕様編集ページ」の各機能について、以下で詳細に示す。
\subsection{描画機能}
描画機能は、以下の4つの機能から成る。
\begin{itemize}
  \item CTM描画機能
  \item フォルダツリー描画機能
  \item \VDM 仕様描画機能
  \item 操作ボタン描画機能
\end{itemize}

以降に、各機能の詳細について述べる。
\subsubsection{CTM描画機能}\label{sec:CTM-drawing-function}
CTM描画機能は、Markdown仕様の記述ルール(\ref{sec:Specrule}節を参照)に則ったMarkdown仕様に
対応するCTMを、自動でCTM領域に描画する機能である。本機能は、ユーザがMarkdown仕様ファイルの選択、および、CTMの編集を行った際に、CTM領域にCTMを描画する。

なお、CTM領域に表示するCTMの具体例は、図\ref{fig:ctm_example}に示したとおりである。

本機能では、Markdown仕様を解析し、表\ref{tab:ctm_elements}に示したCTMの各要素を抽出してCTM領域に描画する。
描画の際には、定義している要素間の関係性を考慮し、適切な位置に配置する (\ref{sec:GUIElementGenerationComponent}節で詳細に説明)ことで、
ユーザが画面遷移の流れを直感的に理解できるようにする。

描画したCTMは、ユーザ操作によってクリックやドラッグが可能であり、
CTM要素のプロパティの編集、および、位置関係を調整できる(\ref{sec:VDM++-generation-function}節を参照)。
また、遷移先がないイベントは、
視覚的に識別できるよう赤色で強調表示を行う。


\subsubsection{フォルダツリー描画機能}
フォルダツリー描画機能は、フォルダツリー表示領域に、ユーザが選択したプロジェクトフォルダのアイテムをツリー形式で描画する機能である。
本機能は、ユーザがフォルダを選択した際にフォルダツリーを描画し、ユーザのフォルダツリーに対する操作に応じて再描画する。

フォルダツリー表示領域に表示するアイテムの対象は、フォルダ、および、拡張子が.mdのMarkdown仕様ファイルである。
ツリーに表示するフォルダには、フォルダ名の左側にフォルダアイコンを表示する。
フォルダツリー表示領域の表示例を、図\ref{fig:folder}に示す。

ユーザは、フォルダツリー表示領域に表示するアイテムを選択することで、フォルダの展開、または、編集対象のMarkdown仕様ファイルを選択できる。
\ref{sec:VDM++-generation-function}節で説明するフォルダの選択、または、新規ファイルの作成を行った際に、フォルダの表示を更新する。


\begin{figure}[tp]
  \centering
  \includegraphics[width=0.5\linewidth]{./images/ディレクトリ例}
  \caption{フォルダツリー表示領域の表示例}
  \label{fig:folder}
\end{figure}

\subsubsection{\VDM 仕様描画機能}
\VDM 仕様描画機能は、\VDM 仕様表示領域に、VDM++仕様を描画する機能である。
フォルダツリー表示領域において、ユーザが編集対象に選択したMarkdown仕様に対応するVDM++仕様を描画する。
本機能は、CTM描画機能と同じタイミングで実行する。
つまり、\tool を操作することによるVDM++仕様への変更は即時反映し、常に最新状態の\VDM 仕様を\VDM 仕様表示領域に描画する。
\VDM 仕様表示領域の表示例を、図\ref{fig:VDMEX}に示す。

\begin{figure}[tp]
  \centering
  \includegraphics[width=0.8\linewidth]{./images/VDMEX}
  \caption{\VDM 仕様表示領域の表示例}
  \label{fig:VDMEX}
\end{figure}
\subsubsection{操作ボタン描画機能}\label{sec:GUI-operation-control-function}
操作ボタン描画機能は、操作ボタン領域に、ユーザ操作によってCTMの編集を行うボタン(以降、操作ボタンと呼ぶ)を描画する機能である。
この機能により、ユーザによるプロジェクトフォルダ選択の有無、および、選択したMarkdown仕様に応じて、
実行可能な操作ボタンのみを操作ボタン領域に描画し、ユーザによる不適切な操作の実行を防止する。
ユーザがフォルダツリー表示領域内のMarkdown仕様を選択した際に、本機能を実行する。
操作ボタンの表示パターンには、「GUI操作による\VDM 仕様編集ページ」への遷移直後、および、編集対象となっている\VDM 仕様のクラスの種類に基づいて、
以下の4種類がある。

\begin{itemize}
  \item 表示パターンA
  \item 表示パターンB
  \item 表示パターンC
  \item 表示パターンD
\end{itemize}

各表示パターンの操作ボタン領域の表示を、図\ref{fig:hyouzi}に示す。
各表示パターンとそれぞれの表示パターンを表示する条件の対応を表\ref{tab:Look_patterns}に、
操作ボタンと各操作ボタン押下時処理の対応を表\ref{tab:Look_patterns_operations}に、それぞれ示す。

各表示パターンについて、以下で説明する。

\paragraph{表示パターンA}

表示パターンAは、「スタートページ」から「GUI操作による\VDM 仕様編集ページ」への遷移直後で、編集対象となるプロジェクトフォルダを選択していない場合の表示パターンである。
表示パターンAは、ユーザによる編集対象となるプロジェクトフォルダの設定を目的としている。
表示パターンAに表示する操作ボタンは、以下の2つである。

\begin{itemize}
  \item 「スタートページに戻る」ボタン
  \item 「フォルダの選択」ボタン
\end{itemize}

\paragraph{表示パターンB}

表示パターンBは、ユーザが画面管理クラスを編集対象として選択した場合の表示パターンである。
表示パターンBは、ユーザによる画面構成の管理を行い、画面管理クラス仕様の作成を行うことを目的としている。表示パターンBに表示する操作ボタンは、以下の3つである。

\begin{itemize}
  \item 「スタートページに戻る」ボタン
  \item 「画面の追加」ボタン
  \item 「削除」ボタン
\end{itemize}

\paragraph{表示パターンC}

表示パターンCは、ユーザが画面クラスを編集対象として選択した場合の表示パターンである。
表示パターンCは、ユーザによる画面ごとの操作と遷移の管理を行い、
それぞれの画面クラス仕様の作成を行うことを目的としている。
表示パターンCに表示する操作ボタンは、以下の6つである。

\begin{itemize}
  \item 「スタートページに戻る」ボタン
  \item 「ボタンの追加」ボタン
  \item 「イベントの追加」ボタン
  \item 「タイムアウトの追加」ボタン
  \item 「クラス名(画面名)の変更」ボタン
  \item 「削除」ボタン
\end{itemize}

\paragraph{表示パターンD}

表示パターンDは、Markdown仕様の記述ルールに従っていないMarkdown仕様を編集対象とした場合の表示パターンである。
表示パターンDは、画面一覧仕様、および、画面仕様でないファイル、または、フォルダに対して、ユーザがCTMの編集に関する操作実行を防止することを目的としている。
表示パターンDに表示する操作ボタンは、以下の2つである。

\begin{itemize}
  \item 「スタートページに戻る」ボタン
  \item 「クラスの種類選択・追加」ボタン
\end{itemize}

\begin{figure}[tp]
  \centering
  \includegraphics[width=0.8\linewidth]{./images/表示方法.png}
  \caption{各表示パターンの操作ボタン領域の表示}
  \label{fig:hyouzi}
\end{figure}

\begin{table}[tp]
  \centering
  \caption{操作ボタン表示パターンと表示条件の対応}
  \label{tab:Look_patterns}
  \begin{tabular}{|c|l|}
    \hline
    \textbf{表示パターン} & \textbf{表示条件} \\
    \hline
    表示パターンA&
    「GUI操作による\VDM 仕様編集ページ」への遷移直後\\
    \hline
    表示パターンB &
    画面管理クラスを編集対象として選択している状態 \\
    \hline
    表示パターンC &
    画面クラスを編集対象として選択している状態 \\
    \hline
    表示パターンD &\begin{tabular}{l}
    クラス定義が存在しないMarkdown仕様ファイルまたはフォルダを\\編集対象として選択している状態 \end{tabular}\\
    \hline
  \end{tabular}
\end{table}


\begin{table}[tp]
  \centering
  \caption{操作ボタンと各操作ボタン押下時処理の対応}
  \label{tab:Look_patterns_operations}
  \begin{tabularx}{\linewidth}{|c|X|}
    \hline
    \textbf{操作ボタン} & \textbf{各操作ボタン押下時処理} \\
    \hline
    フォルダの選択 &
    編集対象となるプロジェクトフォルダを選択し、フォルダツリー表示を更新する。 \\
    \hline
    画面の追加 &
    画面管理クラスに新しい画面要素を追加する。 \\
    \hline
    ボタンの追加 &
    選択中の画面クラスにボタン要素を追加する。 \\
    \hline
    イベントの追加 &
    選択中のボタン要素に対するイベントを追加する。 \\
    \hline
    タイムアウトの追加 &
    選択中の画面クラスにタイムアウトイベントを追加する。 \\
    \hline
    クラス名(画面名)の変更 &
    選択中の画面クラス名を変更する。 \\
    \hline
    クラスの種類選択・追加 &
    画面管理クラスか画面クラスかを選択、仕様のクラス名を定義する。 \\
    \hline
    削除 &
    選択中の要素を削除する。 \\
    \hline
    スタートページへ戻る &
    スタートページへ遷移する。 \\
    \hline
  \end{tabularx}
\end{table}

\subsection{GUI操作による仕様編集機能}\label{sec:VDM++-generation-function}
GUI操作による仕様編集機能は、以下の3つの機能からなる。
\begin{itemize}
\item メニューバーの操作による仕様生成補助機能
\item 操作ボタン領域のボタン操作によるCTM編集機能
\item CTM領域上でのユーザ操作によるCTM編集機能
\end{itemize}

GUI操作による仕様編集機能は、この3つの機能に基づいて、表\ref{tab:ctm_elements}に示したCTM要素を追加、編集、および、削除し、
その結果を、Markdown仕様、および、
\VDM 仕様に変換する機能である。

以降、各機能の詳細を示す。

\subsubsection{メニューバーの操作による仕様生成補助機能}
メニューバーの操作による仕様生成補助機能は、\VDM 仕様生成の補助を行う機能である。メニューバーに表示する、ファイルおよびフォルダに関する機能を操作する。
メニューバーは、ファイルおよびフォルダに関する機能をまとめたメニューである。メニューバーの項目を押すことで開くドロップダウンメニューから、各機能を使用できる。
メニューバーを押すことで開くドロップダウンメニューを、図\ref{fig:drop}に示す。
\begin{figure}[tp]
  \centering
  \includegraphics[width=0.3\linewidth]{./images/drop.png}
  \caption{ドロップダウンメニュー}
  \label{fig:drop}
\end{figure}
ドロップダウンメニューで表示する項目は、以下の2つである。
\begin{itemize}
  \item フォルダを選択
  \item 新規ファイル作成
\end{itemize}
以下に、各項目を選択した際の機能について説明する。

\begin{itemize}
\item \textbf{フォルダを選択}

「フォルダを選択」機能は、操作ボタンの「フォルダの選択」ボタンと同様の機能である。
本機能では、ユーザが「フォルダを選択」項目を押した際に、図\ref{fig:fo}に示すフォルダ選択インターフェースを表示する。
\begin{figure}[tp]
  \centering
  \includegraphics[width=01.0\linewidth]{./images/fo.png}
  \caption{フォルダ選択インターフェース}
  \label{fig:fo}
\end{figure}

ユーザは、フォルダ選択インターフェースで編集対象のプロジェクトフォルダを選択できる。

\item \textbf{新規ファイル作成}

「新規ファイル作成」機能は、空のMarkdown仕様ファイルを作成し、プロジェクトフォルダに追加する機能である。
なお、この際に\VDM 仕様ファイルは作成しない。
本機能では、ユーザが「新規ファイル作成」項目を押した際に、新規ファイル作成ダイアログを表示する。
新規ファイル作成ダイアログの外観を、図\ref{fig:createFile}に示す。

\begin{figure}[tp]
  \centering
  \includegraphics[width=0.4\linewidth]{./images/createFile.png}
  \caption{新規ファイル作成ダイアログの外観}
  \label{fig:createFile}
\end{figure}

ユーザは、新規ファイル作成ダイアログにファイル名を入力することで、新規Markdown仕様ファイルを作成できる。
\end{itemize}

\subsubsection{操作ボタン領域のボタン操作によるCTM編集機能}\label{sec:ButtonFunction}

操作ボタン領域のボタン操作によるCTM編集機能は、操作ボタン領域の操作ボタンを押すことでCTM領域に表示するCTMを編集する機能である。
また、本機能によりCTMを編集した直後、Markdown仕様、および、\VDM 仕様を最新のCTMに対応したものに自動で更新する。

操作ボタン領域のボタン操作によるCTM編集機能は、以下の9つの機能から成る。
\begin{itemize}
  \item クラスの種類選択および追加
  \item 画面の追加
  \item ボタンの追加
  \item タイムアウトの追加
  \item イベントの追加
  \item クラス名(画面名)の変更
  \item 削除
  \item フォルダの選択
  \item スタートページに戻る
\end{itemize}
各機能について、以下で詳細に示す。
\begin{itemize}
\item \textbf{クラスの種類選択および追加}

クラスの種類選択および追加は、プロジェクトフォルダに、
画面管理クラス、または、画面クラスを追加する機能である。
なお、本機能は、表示パターンD(\ref{sec:GUI-operation-control-function}節を参照)においてのみ有効である。

本機能では、ユーザが「クラスの種類選択・追加」ボタンをクリックした際に
表示するクラスの種類選択ダイアログから、追加するクラスの種類を選択する。クラスの種類選択ダイアログの外観を、
図\ref{fig:class_type_dialog}に示す。
ユーザが「画面管理クラスの追加」を選択した場合は、編集対象のMarkdown仕様の1行目に「\# 画面一覧」を追加、および、
対応するVDM++仕様にクラス名として「画面管理」を追加する。さらに、表示パターンBへ自動で切り替える。
ユーザが「画面クラスの追加」を選択した場合は、クラス名を入力するための、画面クラス追加ダイアログを表示する。
画面クラス追加ダイアログの外観を、図\ref{fig:screen_name_dialog}に示す。
ユーザがクラス名を入力後、「OK」をクリックすることで、編集対象のMarkdown仕様の1行目に「\# \# \texttt{入力したクラス名}」を追加、および、
対応するVDM++仕様にユーザが入力したクラス名のクラスを追加する。さらに、表示パターンCへ自動で切り替える。

なお、画面一覧仕様であるMarkdown仕様、および、画面管理クラスである\VDM 仕様が既にプロジェクトフォルダ内に存在する場合は、クラスの種類選択ダイアログの表示は行わず、
直接画面クラス追加ダイアログを表示する。ユーザがクラス名の入力を完了すると、画面一覧仕様であるMarkdown仕様、および、画面管理クラスである\VDM 仕様にユーザが入力した画面クラスに関する情報を追加する。
\begin{figure}[tp]
  \centering
    \centering
    \includegraphics[width=0.4\linewidth]{./images/1-01.png}
    \caption{クラスの種類選択ダイアログの外観}
    \label{fig:class_type_dialog}
\end{figure}
\begin{figure}[tp]
    \centering
    \includegraphics[width=0.4\linewidth]{./images/1-02.png}
    \caption{画面クラス追加ダイアログの外観}
    \label{fig:screen_name_dialog}
\end{figure}

\item \textbf{画面の追加}

画面の追加は、画面管理クラスのCTM上に新たな画面要素を追加する機能である。
なお、本機能は、表示パターンBにおいてのみ有効である。

本機能では、ユーザが「画面の追加」ボタンをクリックした際に画面追加ダイアログを表示する。
そして、ユーザが追加する画面名を入力し、「OK」をクリックすることで、
入力した画面名に基づいて、
CTM上に新たな画面要素を生成し、
画面管理クラスの\VDM 仕様にも、対応する画面に関する情報を自動で追加する。画面追加ダイアログの外観を図\ref{fig:screen_name_dialog_add}に、
「テスト画面」追加後の具体例を図\ref{fig:add_screen}に、それぞれ示す。


\begin{figure}[tp]
  \centering
  \includegraphics[width=0.4\linewidth]{./images/2-01.png}
  \caption{画面追加ダイアログの外観}
  \label{fig:screen_name_dialog_add}
\end{figure}

\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/add_screen.png}
  \caption{「テスト画面」追加後の具体例}
  \label{fig:add_screen}
\end{figure}

\item \textbf{ボタンの追加}

ボタンの追加は、画面クラスのCTM上に新たなボタン要素を追加する機能である。
なお、本機能は、表示パターンCにおいてのみ有効である。

本機能では、ユーザが「ボタンの追加」ボタンをクリックした際に、
ボタン追加ダイアログを表示する。
ユーザは、表示したダイアログに、追加するボタン名を入力し、「OK」をクリックする。これにより、本機能はユーザが
入力したボタン名に基づいて、
CTM上に新たなボタン要素を生成し、対応するボタンに関する情報を自動で\VDM 仕様にも追加する。
ボタン追加ダイアログの外観を図\ref{fig:button_name_dialog}に、
「テストボタン」追加後の具体例を図\ref{fig:add_button}に、それぞれ示す。
\begin{figure}[tp]
  \centering
  \includegraphics[width=0.4\linewidth]{./images/3-01.png}
  \caption{ボタン追加ダイアログの外観}
  \label{fig:button_name_dialog}
\end{figure}

\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/add_button.png}
  \caption{「テストボタン」追加の具体例}
  \label{fig:add_button}
\end{figure}

\item \textbf{イベントの追加}

イベントの追加は、CTM上の特定のボタン要素に対して
新たなイベント要素を追加する機能である。
なお、本機能は、表示パターンCにおいてのみ有効である。

まず、ユーザが「イベントの追加」ボタンをクリックした際に、
対象ボタン選択ダイアログを表示する。対象ボタン選択ダイアログの外観を、図\ref{fig:target_button_selection_dialog}に示す。
ユーザがイベント要素を追加する対象ボタン要素を選択した後、分岐イベント選択ダイアログを表示する。分岐イベント選択ダイアログの外観を、図\ref{fig:branch_event_selection_dialog}に示す。
ユーザが分岐イベント選択ダイアログで「はい」を選択した場合は、分岐イベント入力ダイアログを表示する。分岐イベント入力ダイアログの外観を、図\ref{fig:branch_event_input_dialog}に示す。
ユーザが分岐イベント選択ダイアログで「いいえ」を選択した場合は、単一イベント入力ダイアログを表示する。単一イベント入力ダイアログの外観を、図\ref{fig:normal_event_input_dialog}に示す。
分岐イベント入力ダイアログでは、分岐条件、イベント種別の選択、および、遷移先または操作内容を入力する。
単一イベント入力ダイアログでは、イベント種別の選択、および、遷移先または操作内容を入力する。

イベント種別は、以下の3つである。
\begin{itemize}
  \item 遷移：対象ボタン押下後に特定の画面へ遷移する動作
  \item 追加：対象ボタン押下後に表示部(\ref{sec:2vdm-spec-generator}節を参照)に、指定した文字列を追加する動作
  \item 削除：対象ボタン押下後に表示部から文字列を削除する動作
\end{itemize}

ユーザがイベント情報を入力後、「OK」をクリックすることで、
入力した情報に基づいて、
CTM上に新たなイベント要素、または、分岐イベント要素を生成し、
対応するイベントに関する情報を自動で\VDM 仕様にも追加する。

\begin{figure}[tp]
    \centering
    \includegraphics[width=0.4\linewidth]{./images/5-01.png}
    \caption{対象ボタン選択ダイアログの外観}
    \label{fig:target_button_selection_dialog}
  \end{figure}
  \begin{figure}[tp]
    \centering
    \includegraphics[width=0.4\linewidth]{./images/5-02.png}
    \caption{分岐イベント選択ダイアログの外観}
    \label{fig:branch_event_selection_dialog}
  \end{figure}
\begin{figure}[tp]
  \centering
    \includegraphics[width=0.5\linewidth]{./images/5-03.png}
    \caption{分岐イベント入力ダイアログの外観}
    \label{fig:branch_event_input_dialog}
  \end{figure}
  \begin{figure}[tp]
    \centering
    \includegraphics[width=0.5\linewidth]{./images/5-04.png}
    \caption{単一イベント入力ダイアログの外観}
    \label{fig:normal_event_input_dialog}
  \end{figure}

ユーザが分岐イベントを入力した場合は、「OK」をクリック後、別の分岐イベント追加確認ダイアログを表示する。別の分岐イベント追加確認ダイアログの外観を、図\ref{fig:another_branch_event_dialog}に示す。
ユーザが別の分岐イベント追加確認ダイアログで「はい」を選択した場合は、再度分岐イベント入力ダイアログを表示する。
ユーザが別の分岐イベント追加確認ダイアログで「いいえ」を選択した場合は、イベントの追加操作を終了する。
条件分岐の数に制限はなく、ユーザは必要に応じて複数の分岐イベントを追加できる。

イベントを追加する際、対象ボタンにすでに単一イベントを定義している場合には、
エラーを表示し、処理を中断する。単一イベント追加時のエラー表示例を、図\ref{fig:Eventerror}に示す。
なお、イベントを追加する際、対象ボタンにすでに分岐イベントを定義している場合には、分岐イベントを追加することが可能である。

単一イベント追加後の具体例を図\ref{fig:add_event}に、分岐イベント追加後の具体例を図\ref{fig:add_branch}に、それぞれ示す。

\begin{figure}[tp]
  \centering
  \includegraphics[width=0.4\linewidth]{./images/5-05.png}
  \caption{別の分岐イベント追加確認ダイアログの外観}
  \label{fig:another_branch_event_dialog}
\end{figure}

\begin{figure}[tp]
  \centering
  \includegraphics[width=0.7\linewidth]{./images/イベント追加エラー.png}
  \caption{単一イベント追加時のエラー表示例}
  \label{fig:Eventerror}
\end{figure}

\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/add_event.png}
  \caption{単一イベント追加後の具体例}
  \label{fig:add_event}
\end{figure}

\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/add_branch.png}
  \caption{分岐イベント追加後の具体例}
  \label{fig:add_branch}
\end{figure}

\item \textbf{タイムアウトの追加}

タイムアウトの追加は、CTM上に新たなタイムアウト要素を追加する機能である。
本機能により、CTMに新たなタイムアウト要素を追加、および、更新ができる。
なお、本機能は、表示パターンCにおいてのみ有効である。

本機能では、ユーザが「タイムアウトの追加」ボタンをクリックした際に、タイムアウト設定ダイアログを表示する。
ユーザは、表示したダイアログに、タイムアウト時間およびタイムアウト後遷移先を入力する。
タイムアウト設定ダイアログの外観を、図\ref{fig:timeout_setting_dialog}に示す。

ユーザが、タイムアウト時間およびタイムアウト後遷移先を入力後、「OK」をクリックすることで、
入力した情報に基づいて、
CTM上に新たなタイムアウト要素を生成する。この際、
対応するタイムアウトに関する情報を自動で\VDM 仕様にも追加する。
タイムアウト設定時、タイムアウト時間の入力を省略した状態で「OK」をクリックした場合は、入力エラーを返す。また、
タイムアウト後遷移先の入力を省略した状態で「OK」をクリックした場合は、タイムアウト後の動作を「なし」としてCTM上にタイムアウト要素を生成し、
タイムアウト後の動作を未定義として「\texttt{/* 仕様に記載なし */
}」を\VDM 仕様に追加する。タイムアウト設定時の入力エラーを、図\ref{fig:timeoutError}に示す。

画面クラスの\VDM 仕様のタイムアウトの定義は単一のものであるため、
タイムアウト要素がすでに存在する画面仕様に対して本機能を実行した場合は、
そのタイムアウト要素を更新する。

タイムアウト設定後の具体例を、図\ref{fig:add_timeout}に示す。

\begin{figure}[tp]
    \centering
    \includegraphics[width=0.5\linewidth]{./images/4-01.png}
    \caption{タイムアウト設定ダイアログの外観}
    \label{fig:timeout_setting_dialog}
\end{figure}
\begin{figure}[tp]
    \centering
    \includegraphics[width=0.5\linewidth]{./images/4-02.png}
    \caption{タイムアウト設定時の入力エラー}
    \label{fig:timeoutError}
\end{figure}

\begin{figure}[tp]
  \centering
  \includegraphics[width=1.0\linewidth]{./images/add_timeout.png}
  \caption{タイムアウト設定後の具体例}
  \label{fig:add_timeout}
\end{figure}

\item \textbf{クラス名(画面名)の変更}

クラス名(画面名)の変更は、ユーザが「クラス名(画面名)の変更」ボタンをクリックした際に、
編集対象の画面仕様や、画面クラスのクラス名(画面名)を変更する機能である。本機能は、表示パターンCにおいてのみ有効である

本機能では、ユーザが、「クラス名(画面名)の変更」ボタンをクリックした際に、クラス名変更ダイアログを表示する。
ユーザは、表示したダイアログに、変更後のクラス名(画面名)を入力する。クラス名変更ダイアログの外観を、図\ref{fig:class_dialog}に示す。

ユーザが変更後のクラス名(画面名)を入力後、「変更」をクリックすることで、
入力した情報に基づいて、クラス名(画面名)の変更を行う。\VDM 仕様上のクラス名も変更後のクラス名に自動で変更する。

変更を行う際、画面管理クラスに編集対象の画面名をすでに定義していた場合は、画面管理クラス内も変更後のクラス名(画面名)へと自動で変更を行う。

\begin{figure}[tp]
  \centering
  \includegraphics[width=0.4\linewidth]{./images/6-01.png}
  \caption{クラス名変更ダイアログの外観}
  \label{fig:class_dialog}
\end{figure}


\item \textbf{削除}

削除は、CTMの特定の要素を削除する機能である。
本機能により、ユーザは、不要なCTM要素をCTM領域から削除し、そのCTM要素に対応するMarkdown仕様、および、 VDM++仕様内の記述を削除できる。
本機能は、表示パターンＢ、および、表示パターンＣにおいて有効である。

ユーザは、CTM領域上のCTM要素を左クリックし、削除対象とするCTM要素を決定する。削除対象とするCTM要素を決定後、ユーザが「削除」ボタンをクリックすることで、CTM領域上、Markdown仕様上、および、\VDM 仕様上から対応する要素、および、定義部分の削除を行う。
イベント要素、画面要素、遷移先のないイベント要素、および、タイムアウト要素の削除を行う際は、その要素のみを削除する。分岐イベント要素に関しては、分岐条件ごとに削除が可能である。
また、ボタン要素の削除を行う際は、そのボタン要素に関連するイベント要素も同時に削除する。


\item \textbf{フォルダの選択}\label{sec:SelectFolderButton}

フォルダの選択は、メニューバーの操作による仕様生成補助機能の「フォルダを選択」と同様の機能である。本機能は、表示パターンDにおいてのみ有効である。

ユーザは「フォルダを選択」ボタンを押した際に、図\ref{fig:fo}に示したインターフェースにより、編集対象とするプロジェクトフォルダを選択する。
ユーザがプロジェクトフォルダを選択した後、フォルダツリー表示領域に、選択したプロジェクトフォルダ内のフォルダ、および、Markdown仕様ファイルをツリー状に表示する。

\item \textbf{スタートページに戻る}

スタートページに戻るは、「GUI操作による\VDM 仕様編集ページ」から「スタートページ」へ遷移する機能である。

ユーザが「スタートページへ戻る」ボタンを押した際に、「GUI操作による\VDM 仕様編集ページ」から「スタートページ」へ遷移する。
\end{itemize}

\subsubsection{CTM領域上でのユーザ操作によるCTM編集機能}
CTM領域上でのユーザ操作によるCTM編集機能は、CTM領域内のCTM要素それぞれに対してユーザ操作による編集を行う機能である。
本機能は、以下の2つの機能からなる
\begin{itemize}
  \item 右クリック操作
  \item 左クリック操作
\end{itemize}

各機能について、以下で説明する。
\begin{itemize}
\item \textbf{右クリック操作}

右クリック操作は、CTM 要素に対して、それぞれの要素に応じた編集機能を提供する機能である。
本機能により、ユーザは対象CTM要素の種類に応じて、追加、編集、削除、および、コピーを効率的に実行できる。
右クリックを行った場合、対象CTM要素の種類に基づき、表示する操作候補(コンテキストメニュー)を決定する。各CTM要素に対するコンテキストメニューの表示例を、
図\ref{fig:context}、図\ref{fig:1context}、図\ref{fig:2context}、図\ref{fig:3context}、および、図\ref{fig:4context}にそれぞれ示す。
分岐イベント要素の場合は、各分岐条件ごとに右クリックを区別し、選択した分岐条件に対する編集や削除を可能とする。
なお、右クリック操作は操作ボタンと同等の編集機能を提供する。
また、右クリックのコンテキストメニューからイベント要素の追加を行う際は、すでに対象ボタンを選択しているため、
対象ボタン選択ダイアログの表示を省略し、分岐イベント選択ダイアログを表示する。
さらに、ユーザは、右クリック操作でのみ、以下の2つの機能を利用できる。
\begin{itemize}
  \item 要素の編集
  \item コピー\&ペースト
\end{itemize}


\begin{figure}[tp]
    \centering
    \includegraphics[width=0.45\linewidth]{./images/context.png}
    \caption{ボタン要素のコンテキストメニューの表示例}
    \label{fig:context}
  \end{figure}
  \begin{figure}[tp]
    \centering
    \includegraphics[width=0.45\linewidth]{./images/1context.png}
    \caption{イベント要素のコンテキストメニューの表示例}
    \label{fig:1context}
  \end{figure}
  \begin{figure}[tp]
    \centering
    \includegraphics[width=0.45\linewidth]{./images/2context.png}
    \caption{タイムアウト要素のコンテキストメニューの表示例}
    \label{fig:2context}
  \end{figure}
  \begin{figure}[tp]
    \centering
    \includegraphics[width=0.45\linewidth]{./images/3context.png}
    \caption{分岐イベント要素のコンテキストメニューの表示例}
    \label{fig:3context}
  \end{figure}
  \begin{figure}[tp]
    \centering
    \includegraphics[width=0.45\linewidth]{./images/4context.png}
    \caption{画面要素のコンテキストメニューの表示例}
    \label{fig:4context}
  \end{figure}
以降に、この2つの機能について説明する。
\subparagraph{要素の編集}

要素の編集は、対象のCTM要素の内容を編集する。本機能は、操作ボタン領域のボタン操作によるCTM編集機能の中で
各CTM要素の追加に関する機能を実行する際に表示するダイアログと同様のダイアログに現在のCTM上の表示内容を入力した状態で表示する。
ユーザが、そのダイアログ中の内容を変更することで、対象とするCTM要素の内容を編集する機能である。
また、ユーザがダイアログ中の「キャンセル」をクリックした場合は、編集機能を中断する。

\subparagraph{コピー\&ペースト}
ユーザは、コンテキストメニュー内の「コピー」を選択し、「貼り付け」をクリックすることで対象要素を複製できる。
なお、コピー\&ペーストは、ボタン要素、および、画面要素に対してのみ行うことができる機能である。
複製の際、名称を定義するため、要素の名称を入力するダイアログを表示する。コピー時ボタン名入力ダイアログの外観を図\ref{fig:copyB}に、
コピー時画面名入力ダイアログの外観を図\ref{fig:copyS}に、それぞれ示す。この際、ユーザが元の名称のまま「OK」をクリックした場合、エラーを表示し、処理を中断する。エラー表示を、図\ref{fig:copyError}に示す。
また、ボタン要素にイベント要素が関連づいている場合、そのイベント要素も自動で複製する。
ただし、イベント名は、「コピー」として複製する。

貼り付け後の具体例を、図\ref{fig:add_copy}に示す。

\begin{figure}[tp]
  \centering
    \includegraphics[width=0.45\linewidth]{./images/10-1.png}
    \caption{コピー時ボタン名入力ダイアログの外観}
    \label{fig:copyB}
  \end{figure}
  \begin{figure}[tp]
    \centering
    \includegraphics[width=0.45\linewidth]{./images/10-2.png}
    \caption{コピー時画面名入力ダイアログの外観}
    \label{fig:copyS}
  \end{figure}

\begin{figure}[tp]
  \centering
    \includegraphics[width=0.45\linewidth]{./images/copyError.png}
    \caption{貼り付け時のエラー表示}
    \label{fig:copyError}
  \end{figure}
  \begin{figure}[tp]
    \centering
  \includegraphics[width=1.0\linewidth]{./images/add_copy.png}
  \caption{貼り付け後の具体例}
  \label{fig:add_copy}
  \end{figure}


\item \textbf{左クリック操作}

左クリック操作は、CTM要素に対して、以下の3つの機能を提供する。
\begin{itemize}
  \item 編集対象CTM要素選択
  \item ドラッグ操作
  \item 画面管理クラスから対象画面クラスへの遷移
\end{itemize}

以降に、左クリック操作が提供する機能について説明する。

\subparagraph{編集対象CTM要素選択}
編集対象CTM要素選択は、ユーザが対象CTM要素上で左クリックを1回することで、そのCTM要素を選択状態にする機能である。
選択状態のCTM要素は、そのCTM要素の周りをオレンジ色の太線で囲むことで強調表示し、
ユーザに現在の編集対象を視覚的に示す。強調表示の例を、図\ref{fig:pick}に示す。
CTM要素が存在しないCTM領域を左クリックした場合は、選択中のCTM要素の選択状態を解除する。

\begin{figure}
  \centering
  \includegraphics[width=0.6\linewidth]{./images/Pick.png}
  \caption{ボタン1選択時の強調表示}
  \label{fig:pick}
\end{figure}

\subparagraph{ドラッグ操作}

ドラッグ操作は、CTM要素を左クリックしている間移動可能な要素(\ref{sec:GUIElementGenerationComponent}節を参照)に限り、CTM領域内を移動できる機能である。
このドラッグ操作の結果は、\VDM 仕様上での定義の順序に関係しているため、ドラッグ操作によるCTM要素の新しい配置情報は、ドラッグ操作ごとにCTM要素の配置情報を示すJSONファイルとして出力する(\ref{sec:FileUpdateProcess}節を参照)。
図\ref{fig:pick}に示すCTMのボタン要素(1,2,3)の配置情報を示すJSONファイルの例を、リスト\ref{lst:JSON_example}に示す。ドラッグ操作の結果に応じて配置情報を示すJSONファイルの内容を書き換える。
また、CTM要素の配置変更を\VDM 仕様の定義の順序にも反映する。

\begin{figure}[tp]
\begin{lstlisting}[caption={CTM要素の配置情報を示すJSONファイルの例}, label={lst:JSON_example}, language={}]
[
  {
    "Name": "1",
    "X": 40,
    "Y": 40
  },
  {
    "Name": "2",
    "X": 40,
    "Y": 120
  },
  {
    "Name": "3",
    "X": 40,
    "Y": 200
  }
]
\end{lstlisting}
\end{figure}


\subparagraph{画面管理クラスから対象画面クラスへの遷移}
画面管理クラスから対象画面クラスへの遷移は、画面管理クラスのCTM要素である画面要素を左ダブルクリックすることで、対応する画面クラスの編集画面へと遷移する機能である。
なお、本機能は、画面管理クラスで定義する画面要素の名称と、画面クラスで定義しているクラス名 (画面名) が完全に一致している場合に限り、使用できる。
画面管理クラスには定義しているが、画面クラスとして存在していない場合、エラーを表示し、機能を中断する。画面管理クラスで定義した画面要素が画面クラスとして存在しない場合のエラー表示例を、図\ref{fig:error}に示す。
\begin{figure}
  \centering
  \includegraphics[width=0.6\linewidth]{./images/error.png}
  \caption{画面管理クラスで定義した画面要素が画面クラスとして存在しない場合のエラー表示例}
  \label{fig:error}
\end{figure}

\end{itemize}